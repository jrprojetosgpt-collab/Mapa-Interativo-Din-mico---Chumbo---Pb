<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mapa Interativo — Pb</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>html,body,#map{height:100%;margin:0}</style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* ===== MAPA (fallback fixo) ===== */
const map = L.map('map', {minZoom:10,maxZoom:22}).setView([-29.645642, -51.015153], 17);

/* ===== BASE SIMPLES (OSM) ===== */
const osm = L.tileLayer(
  "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
  {attribution:"© OpenStreetMap", maxZoom:22, crossOrigin:true}
).addTo(map);

/* ===== RASTERS (pastas no mesmo nível do index.html) ===== */
const raster1 = L.tileLayer("18/{x}/{y}.png", {
  minNativeZoom:18, maxNativeZoom:18, tileSize:256, crossOrigin:true
}).addTo(map);

const raster2 = L.tileLayer("18_II/18/{x}/{y}.png", {
  minNativeZoom:18, maxNativeZoom:18, tileSize:256, crossOrigin:true
}).addTo(map);

const raster3 = L.tileLayer("18_III/18/{x}/{y}.png", {
  minNativeZoom:18, maxNativeZoom:18, tileSize:256, crossOrigin:true
}).addTo(map);

/* ===== CONTROLE DE CAMADAS ===== */
const baseMaps = { "OSM": osm };
const overlays = {
  "1ª Campanha Pb": raster1,
  "2ª Campanha Pb": raster2,
  "3ª Campanha Pb": raster3
};
const ctrl = L.control.layers(baseMaps, overlays, {collapsed:false}).addTo(map);

/* ===== FUNÇÕES AUX ===== */
function addGeoJSON(url, opts={}, name=null){
  return fetch(url, {cache:'no-store'})
    .then(r => { if(!r.ok) throw new Error(url); return r.json(); })
    .then(gj => {
      const lyr = L.geoJSON(gj, opts).addTo(map);
      if (name) ctrl.addOverlay(lyr, name);
      return lyr;
    })
    .catch(e => console.warn("Não carregou:", e.message));
}

/* ===== ÁREA (faz o fitBounds se carregar) ===== */
addGeoJSON("Area_Estudo_PLUMA.geojson",
  {style:{color:"#0066CC",weight:2,fillColor:"#66B2FF",fillOpacity:0.15}},
  "Área de Estudo"
).then(lyr => { if (lyr) map.fitBounds(lyr.getBounds()); });

/* ===== CONTORNOS ===== */
addGeoJSON("Contornos.geojson",
  {style:{color:"#000",weight:2,fillOpacity:0}},
  "Linhas Equipotenciais (m)"
);

/* ===== DIRECIONAMENTO DO FLUXO (apenas pontos como marcadores pretos) ===== */
addGeoJSON("Dir_Flux_Subt.geojson",
  {pointToLayer:(f,latlng)=>L.circleMarker(latlng,{radius:4,color:"#000",fillColor:"#000",fillOpacity:1})},
  "Direcionamento do Fluxo Subterrâneo"
);

/* ===== PMS ===== */
addGeoJSON("PMs.geojson",
  {pointToLayer:(f,latlng)=>L.circleMarker(latlng,{radius:6,color:"#000",fillColor:"#00AEEF",fillOpacity:1,weight:1.5})},
  "Poços de Monitoramento (PM)"
);
</script>
</body>
</html>










